<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <title>Quill Editor with Markdown Support</title>
  <link rel="icon" type="image/svg+xml" href="favicon.svg">
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

  <!-- <link href="https://cdn.quilljs.com/1.3.6/quill.snow.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/quilljs-markdown@latest/dist/quilljs-markdown-common-style.css" rel="stylesheet"> -->
  <style>
    body {
      margin: 0;
      overflow: hidden;
      font-family: Arial, sans-serif;
    }

    #popup {
      position: absolute;
      top: 10px;
      left: 10px;
      background: white;
      padding: 10px;
      border: 1px solid black;
      display: none;
      box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
      z-index: 1001;
      /* Ensure popup is above other elements */
      max-width: 90%;
      max-height: 90%;
      overflow: auto;

      opacity: 0;
      transform: translateY(-20px);
    }

    .popup-content {
      max-width: 100%;
      max-height: 100%;
      overflow: auto;
    }

    #popup.show {
      display: block;
      /* Show when .show class is added */
      animation: popupFadeIn 0.3s forwards;
    }

    #popup.hide {
      animation: popupFadeOut 0.3s forwards;
    }

    .content-pre {
      max-width: 400px;
      white-space: pre-wrap;
      /* Add this property */
    }

    .tag {
      display: inline-block;
      padding: 5px;
      /* margin: 5px; */
      margin: 2px;
      background-color: azure;
      border-radius: 5px;
      color: #000;
    }

    .slideout {
      position: fixed;
      right: 0;
      top: 0;
      width: 300px;
      height: 100%;
      background-color: #f1f1f1;
      box-shadow: -2px 0 5px rgba(0, 0, 0, 0.5);
      transform: translateX(100%);
      transition: transform 0.3s ease;
      z-index: 1000;
      /* Ensure slideout is above the canvas */
    }

    .slideout.active {
      transform: translateX(0);
      /* right: 300px; */
    }

    #editor-container {
      height: 100%;
      padding: 10px;
      background-color: white;
      border: 1px solid #ccc;
    }

    .ai-text {
      background-color: #f0f0f0;
      color: #007bff;
      padding: 5px;
    }


    /* INNER SLIDE */
    .inner-slideout {
      position: absolute;
      right: 0px;
      top: 0;
      width: 300px;
      height: 100%;
      padding-top: 50px;
      /* background-color: #e0e0e0; */
      box-shadow: -2px 0 5px rgba(0, 0, 0, 0.5);
      transform: translateX(100%);
      transition: transform 0.3s ease;
      z-index: 1001;
      /* Ensure inner-slideout is above the slideout */

    }

    .inner-slideout.active {
      transform: translateX(-300px);
    }

    /* TREE */

    .tree {
      position: relative;
      background: white;
      margin-top: 20px;
      padding: 30px;
      font-family: 'Roboto Mono', monospace;
      font-size: .85rem;
      font-weight: 400;
      line-height: 1.5;
      color: #212529;
    }

    .tree span {
      font-size: 13px;
      font-style: italic;
      letter-spacing: .4px;
      color: #a8a8a8;
    }

    .tree .fa-folder-open,
    .tree .fa-folder {
      color: #007bff;
    }

    .tree .fa-html5 {
      color: #f21f10;
    }

    .tree ul {
      padding-left: 5px;
      list-style: none;
    }


    .tree .checkbox-wrapper {
      display: flex;
      align-items: center;
      margin-left: 10px;
    }

    .tree input[type="checkbox"] {
      margin: 0;
      cursor: pointer;
      width: 16px;
      height: 16px;
    }

    .tree span {
      margin-right: 15px;
      /* Add space before checkbox */
    }

    /* Style for the container holding file name and size */
    .tree .content-wrapper {
      display: flex;
      flex-direction: column;
      padding: 8px;
      /* align-items: center; */
      cursor: pointer;
      grid-column: 1;
      transition: background-color 0.2s ease;
      /* margin-right: 10px; */
      min-width: 0;
    }

    .content-wrapper:hover {
      background-color: rgba(0, 0, 0, 0.05);
    }

    .content-wrapper.selected {
      background-color: rgba(0, 0, 0, 0.1);
    }

    .tree li {
      position: relative;
      padding-top: 5px;
      padding-bottom: 5px;
      padding-left: 15px;
      box-sizing: border-box;
      list-style: none;
      min-width: 0;
      /* Enable truncation */
    }

    .tree .file-name {
      display: flex;
      align-items: center;
      margin-bottom: 4px;
      min-width: 0;
      /* Enable truncation */
    }

    .tree .file-name span {
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
      max-width: 200px;
      /* Adjust this value as needed */
    }

    .tree .file-details {
      display: flex;
      align-items: center;
      margin-left: 24px;
      /* Aligns with the text after icon */
      font-size: 12px;
      color: #666;
      justify-content: space-between;
    }

    .tree li:before {
      position: absolute;
      top: 15px;
      left: 0;
      width: 10px;
      height: 1px;
      margin: auto;
      content: '';
      background-color: #666;
    }

    .tree li:after {
      position: absolute;
      top: 0;
      bottom: 0;
      left: 0;
      width: 1px;
      height: 100%;
      content: '';
      background-color: #666;
    }

    .tree li:last-child:after {
      height: 15px;
    }

    .tree a {
      cursor: pointer;
    }

    .tree a:hover {
      text-decoration: none;
    }


    /* sidebar */

    .tooltip {
      position: absolute;
      left: 100%;
      top: 50%;
      transform: translateY(-50%) translateX(10px);
      background-color: #333;
      color: white;
      padding: 5px 10px;
      border-radius: 4px;
      font-size: 12px;
      white-space: nowrap;
      opacity: 0;
      pointer-events: none;
      transition: opacity 0.3s, transform 0.3s;
    }

    .sidebar {
      position: fixed;
      left: 0;
      top: 0;
      height: 100vh;
      width: 40px;
      background-color: #f1f1f1;
      box-shadow: 2px 0 5px rgba(0, 0, 0, 0.1);
      display: flex;
      flex-direction: column;
      align-items: center;
      padding-top: 20px;
    }

    .sidebar-icon {
      position: relative;
      color: #333;
      width: 24px;
      height: 24px;
      margin-bottom: 30px;
      cursor: pointer;
      transition: color 0.3s ease;
    }

    .sidebar-icon:hover {
      color: #007bff;
    }

    .sidebar {
      position: fixed;
      left: 0;
      top: 0;
      height: 100%;
      width: 60px;
      background-color: #f1f1f1;
      box-shadow: 2px 0 5px rgba(0, 0, 0, 0.1);
      display: flex;
      flex-direction: column;
      align-items: center;
      padding-top: 20px;
    }

    .sidebar-icon {
      color: #333;
      font-size: 24px;
      margin-bottom: 30px;
      cursor: pointer;
      transition: color 0.3s ease;
    }

    .sidebar-icon:hover {
      color: #007bff;
    }

    .small-icon {
      height: 16px;
      width: 16px;
    }

    .modal {
      /* Positioning */
      position: fixed;
      left: 5rem;
      top: 50%;
      transform: translateY(-50%);
      z-index: 2001;
      /* Consistently higher than canvas */

      /* Dimensions */
      width: 15.625rem;

      /* Visual styling */
      background-color: white;
      padding: 1.25rem;
      box-shadow: 0.125rem 0 0.3125rem rgba(0, 0, 0, 0.1);
      border-radius: 4px;

      /* Layout */
      display: flex;
      flex-direction: column;
      align-items: flex-start;
      gap: 0.75rem;
      /* Consistent spacing between elements */

      /* Interaction */
      pointer-events: all !important;

      /* Animation */
      opacity: 0;
      visibility: hidden;
      transition:
        opacity 0.3s ease-out,
        transform 0.3s ease-out,
        visibility 0.3s ease-out;
    }

    /* Arrow decoration */
    .modal::before {
      content: '';
      position: absolute;
      left: -0.625rem;
      top: 1.25rem;
      /* Align with first element */
      width: 0;
      height: 0;
      border-top: 0.625rem solid transparent;
      border-bottom: 0.625rem solid transparent;
      border-right: 0.625rem solid white;
      pointer-events: none;
      /* Ensure arrow doesn't interfere with clicks */
    }

    /* Active state */
    .modal.active {
      opacity: 1;
      visibility: visible;
      transform: translateY(0);
    }

    /* Form elements */
    .modal input {
      /* width: 90%; */
      padding: 0.75rem;
      margin: 0;
      /* Remove margin, use gap instead */
      border: 1px solid #ccc;
      border-radius: 4px;
      font-size: 1rem;
      pointer-events: all !important;
    }

    .modal input:focus {
      outline: 2px solid #007bff;
      border-color: #007bff;
    }

    .modal button {
      width: 100%;
      padding: 0.75rem 1.25rem;
      background-color: #007bff;
      color: white;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      font-size: 1rem;
      font-weight: 500;
      pointer-events: all !important;
      transition: background-color 0.2s ease;
    }

    .modal button:hover {
      background-color: #0056b3;
    }

    .modal button:active {
      background-color: #004085;
    }

    /* Status element */
    .modal #status {
      width: 100%;
      min-height: 1.5rem;
      font-size: 0.875rem;
      color: #666;
    }

    /* Ensure all children are interactive */
    .modal * {
      pointer-events: all !important;
    }

    .tooltip {
      position: absolute;
      left: 100%;
      top: 50%;
      transform: translateY(-50%);
      background-color: #333;
      color: white;
      padding: 5px 10px;
      border-radius: 4px;
      font-size: 12px;
      white-space: nowrap;
      opacity: 0;
      pointer-events: none;
      transition: opacity 0.3s, transform 0.3s;
      z-index: 1000;
      margin-left: 10px;
    }

    .sidebar-icon:hover .tooltip {
      opacity: 1;
      transform: translateY(-50%) translateX(5px);
    }

    .p2p_peer_input {
      width: 90%;
    }

    canvas {
      pointer-events: auto;
    }

    .overlay.show {
      display: block;
      animation: overlayFadeIn 0.3s forwards;
    }

    @keyframes overlayFadeIn {
      from {
        opacity: 0;
      }

      to {
        opacity: 1;
      }
    }

    .overlay {
      position: fixed;
      /* Ensures the overlay covers the viewport */
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-color: rgba(0, 0, 0, 0.5);
      /* Semi-transparent background */
      z-index: 1000;
      /* Should be below the popup's z-index */
      display: none;
      /* Hidden by default */
      opacity: 0;
      /* Initial opacity for fade-in effect */
      transition: opacity 0.3s ease;
      /* Smooth transition for opacity */
    }


    .overlay.hide {
      animation: overlayFadeOut 0.3s forwards;
    }

    @keyframes overlayFadeOut {
      from {
        opacity: 1;
      }

      to {
        opacity: 0;
      }
    }

    /* Add these styles to your existing CSS */
    .modal-icons {
      display: flex;
      justify-content: space-around;
      align-items: center;
      width: 100%;
    }

    .modal-icon {
      width: 40px;
      height: 40px;
      cursor: pointer;
      border-radius: 50%;
      background-color: #f0f0f0;
      transition: background-color 0.3s ease;
      display: flex;
      justify-content: center;
      align-items: center;
      position: relative;
      overflow: hidden;
    }

    .modal-icon:hover {
      background-color: #e0e0e0;
    }

    .modal-icon svg {
      width: 24px;
      height: 24px;
    }

    @keyframes spin {
      0% {
        transform: rotate(0deg);
      }

      100% {
        transform: rotate(360deg);
      }
    }

    .spinner {
      width: 24px;
      height: 24px;
      border: 2px solid #f3f3f3;
      border-top: 2px solid #333;
      border-radius: 50%;
      animation: spin 1s linear infinite;
    }

    .download-button {
      display: flex;
      align-items: center;
      background-color: #ffffff;
      border: 1px solid #ccc;
      padding: 8px 12px;
      cursor: pointer;
      transition: background-color 0.3s, color 0.3s;
      border-radius: 4px;
    }

    .download-button:hover {
      background-color: #e0f0ff;
      /* Light blue background on hover */
      color: #007bff;
      /* Change text color on hover */
    }

    .download-button svg {
      width: 32px;
      height: 32px;
      margin-right: 8px;
      transition: fill 0.3s;
    }

    .download-button:hover svg {
      fill: #007bff;
      /* Light blue icon on hover */
    }

    .download-label {
      font-size: 16px;
      color: inherit;
    }

    .popup-body {
      max-width: 400px;
    }

    .popup-close {
      position: absolute;
      top: 10px;
      right: 10px;
      cursor: pointer;
      font-size: 24px;
    }

    @keyframes popupFadeIn {
      from {
        opacity: 0;
        transform: translateY(-20px);
      }

      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    @keyframes popupFadeOut {
      from {
        opacity: 1;
        transform: translateY(0);
      }

      to {
        opacity: 0;
        transform: translateY(-20px);
      }
    }

    /* process */
    #status-container {
      position: fixed;
      top: 20px;
      left: 50%;
      transform: translateX(-50%);
      max-width: 300px;
      width: 90%;
      padding: 0.75rem;
      background-color: rgba(255, 255, 255, 0.1);
      backdrop-filter: blur(10px);
      -webkit-backdrop-filter: blur(10px);
      /* For Safari */
      border-radius: 10px;
      box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
      z-index: 10000;
      opacity: 0;
      transition: opacity 0.5s ease-in-out;
      pointer-events: none;
    }

    #status-container.visible {
      opacity: 1;
    }

    .status-item {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 0.5rem;
      opacity: 0;
      animation: fadeIn 0.5s ease-in forwards;
    }

    .status-item span {
      font-family: 'Courier New', monospace;
      color: #3498db;
      /* Keeping the blue color */
      font-size: 14px;
      margin-right: 10px;
      text-shadow: 0 0 10px rgba(52, 152, 219, 0.5);
      /* Subtle glow for readability */
    }

    @keyframes fadeIn {
      from {
        opacity: 0;
      }

      to {
        opacity: 1;
      }
    }

    .spinner {
      width: 16px;
      height: 16px;
      border: 2px solid rgba(52, 152, 219, 0.3);
      border-top: 2px solid #3498db;
      border-radius: 50%;
      animation: spin 1s linear infinite;
      flex-shrink: 0;
    }

    @keyframes spin {
      0% {
        transform: rotate(0deg);
      }

      100% {
        transform: rotate(360deg);
      }
    }

    .checkmark {
      color: #2ecc71;
      font-size: 16px;
      flex-shrink: 0;
      text-shadow: 0 0 10px rgba(46, 204, 113, 0.5);
      /* Subtle glow for the checkmark */
    }

    /* end of process */

    /* text3d modal */

    .modal-text3d {
      display: none;
      position: fixed;
      z-index: 1000;
      background-color: rgba(0, 0, 0, 0.7);
      padding: 20px;
      border-radius: 5px;
      max-width: 500px;
      max-height: 80vh;
      overflow-y: auto;
    }

    .modal-content-text3d {
      background-color: #f4f4f4;
      padding: 20px;
      border-radius: 5px;
    }

    .close-text3d {
      color: #aaa;
      float: right;
      font-size: 28px;
      font-weight: bold;
      cursor: pointer;
    }

    .close-text3d:hover,
    .close-text3d:focus {
      color: #000;
      text-decoration: none;
      cursor: pointer;
    }

    #modalText-text3d {
      margin-bottom: 20px;
    }

    #editText-text3d {
      width: 100%;
      margin-bottom: 10px;
    }

    #sendButton-text3d {
      background-color: #4CAF50;
      color: white;
      padding: 10px 15px;
      border: none;
      border-radius: 4px;
      cursor: pointer;
    }

    #sendButton-text3d:hover {
      background-color: #45a049;
    }

    /* EDITOR */


    #editor-app {
      display: flex;
      flex-direction: column;
      height: 100vh;
    }

    #editor-tabs {
      display: flex;
      background-color: #f1f1f1;
      border-bottom: 1px solid #ccc;
    }

    #tab-list {
      display: flex;
      flex-grow: 1;
    }

    .editor-tab {
      padding: 10px 20px;
      background-color: #e1e1e1;
      border-right: 1px solid #ccc;
      cursor: move;
      position: relative;
      padding-right: 20px;
      /* Make room for close button */
    }

    .editor-tab.active {
      background-color: #fff;
    }

    #add-tab {
      padding: 10px 15px;
      background-color: #f1f1f1;
      border: none;
      cursor: pointer;
    }


    .close-tab {
      position: absolute;
      right: 5px;
      top: 50%;
      transform: translateY(-50%);
      background: none;
      border: none;
      cursor: pointer;
      font-size: 16px;
      color: #666;
    }

    .close-tab:hover {
      color: #000;
    }



    .drop-indicator {
      position: absolute;
      height: 2px;
      background-color: #0052CC;
      transition: all 0.2s ease;
      display: none;
      pointer-events: none;
      z-index: 1000;
    }

    .editor-tab.highlight {
      outline: 2px solid lightblue;
    }

    .editor-tab.tab-hover {
      outline: 2px solid lightblue;
    }

    .editor-tab.dragging {
      opacity: 0.5;
    }

    .drop-indicator {
      position: absolute;
      width: 2px;
      background-color: blue;
      transition: all 0.2s ease;
    }

    /* end point textmodal 3d */


    /* left slideout */

    /* Sidebar styles - ensure it stays fixed */
    .sidebar {
      position: fixed;
      left: 0;
      top: 0;
      height: 100%;
      width: 60px;
      background-color: #f1f1f1;
      box-shadow: 2px 0 5px rgba(0, 0, 0, 0.1);
      display: flex;
      flex-direction: column;
      align-items: center;
      padding-top: 20px;
      z-index: 1000;
    }

    /* Left slideout styles */
    .left-slideout {
      position: fixed;
      left: 60px;
      /* Align with the end of sidebar */
      top: 0;
      width: 300px;
      height: 100%;
      background: white;
      box-shadow: 2px 0 5px rgba(0, 0, 0, 0.5);
      transform: translateX(-100%);
      transition: transform 0.3s ease;
      z-index: 999;
    }

    .left-slideout.active {
      transform: translateX(0);
    }

    /* File tree container styles */
    #fileTreeContainer {
      height: 100%;
      overflow-y: auto;
      padding: 20px;
    }

    /* Ensure file tree button stays clickable */
    #fileTreeBtn {
      position: relative;
      z-index: 1000;
    }

    /* Tree styles */
    .tree {
      background: white;
      margin-top: 20px;
      padding: 20px;
      border-radius: 4px;
    }

    /* file tree */

    .fa-folder-open::before {
      content: '';
      display: inline-block;
      width: 16px;
      height: 16px;
      background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='%23007bff' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3E%3Cpath d='M22 19a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h5l2 3h9a2 2 0 0 1 2 2z'%3E%3C/path%3E%3C/svg%3E");
      background-size: contain;
      background-repeat: no-repeat;
      margin-right: 5px;
      vertical-align: middle;
    }

    .fa-folder::before {
      content: '';
      display: inline-block;
      width: 16px;
      height: 16px;
      background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='%23007bff' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3E%3Cpath d='M22 19a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h5l2 3h9a2 2 0 0 1 2 2z'%3E%3C/path%3E%3C/svg%3E");
      background-size: contain;
      background-repeat: no-repeat;
      margin-right: 5px;
      vertical-align: middle;
    }

    .fa-code::before {
      content: '';
      display: inline-block;
      width: 16px;
      height: 16px;
      background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='%23007bff' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3E%3Cpolyline points='16 18 22 12 16 6'%3E%3C/polyline%3E%3Cpolyline points='8 6 2 12 8 18'%3E%3C/polyline%3E%3C/svg%3E");
      background-size: contain;
      background-repeat: no-repeat;
      margin-right: 5px;
      vertical-align: middle;
    }

    .fab.fa-html5::before {
      content: '';
      display: inline-block;
      width: 16px;
      height: 16px;
      background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='%23f21f10' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3E%3Cpath d='M13 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V9z'%3E%3C/path%3E%3Cpolyline points='13 2 13 9 20 9'%3E%3C/polyline%3E%3C/svg%3E");
      background-size: contain;
      background-repeat: no-repeat;
      margin-right: 5px;
      vertical-align: middle;
    }

    .fa-picture-o::before {
      content: '';
      display: inline-block;
      width: 16px;
      height: 16px;
      background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='%23007bff' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3E%3Crect x='3' y='3' width='18' height='18' rx='2' ry='2'%3E%3C/rect%3E%3Ccircle cx='8.5' cy='8.5' r='1.5'%3E%3C/circle%3E%3Cpolyline points='21 15 16 10 5 21'%3E%3C/polyline%3E%3C/svg%3E");
      background-size: contain;
      background-repeat: no-repeat;
      margin-right: 5px;
      vertical-align: middle;
    }


    /* Text document icon */
    .fa-file-text::before {
      content: '';
      display: inline-block;
      width: 16px;
      height: 16px;
      background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='%23007bff' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3E%3Cpath d='M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z'%3E%3C/path%3E%3Cpolyline points='14 2 14 8 20 8'%3E%3C/polyline%3E%3Cline x1='16' y1='13' x2='8' y2='13'%3E%3C/line%3E%3Cline x1='16' y1='17' x2='8' y2='17'%3E%3C/line%3E%3Cpolyline points='10 9 9 9 8 9'%3E%3C/polyline%3E%3C/svg%3E");
      background-size: contain;
      background-repeat: no-repeat;
      margin-right: 5px;
      vertical-align: middle;
    }

    /* PDF document icon */
    .fa-file-pdf::before {
      content: '';
      display: inline-block;
      width: 16px;
      height: 16px;
      background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='%23dc3545' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3E%3Cpath d='M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z'%3E%3C/path%3E%3Cpolyline points='14 2 14 8 20 8'%3E%3C/polyline%3E%3Ctext x='8' y='19' font-family='sans-serif' font-size='8' fill='%23dc3545'>PDF</text%3E%3C/svg%3E");
      background-size: contain;
      background-repeat: no-repeat;
      margin-right: 5px;
      vertical-align: middle;
    }

    /* Generic/unknown file icon */
    .fa-file::before {
      content: '';
      display: inline-block;
      width: 16px;
      height: 16px;
      background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='%236c757d' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3E%3Cpath d='M13 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V9z'%3E%3C/path%3E%3Cpolyline points='13 2 13 9 20 9'%3E%3C/polyline%3E%3C/svg%3E");
      background-size: contain;
      background-repeat: no-repeat;
      margin-right: 5px;
      vertical-align: middle;
    }


    /* NEW CSS TO UPDATE CANVAS LAYER */
    #ui-layer {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      pointer-events: none;
      z-index: 2000;
    }

    #ui-layer>* {
      pointer-events: auto;
    }

    #canvas-container {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      z-index: 1;
    }

    #editor-container:focus {
    outline: none;
}

#editor-container *:focus {
    outline: none;
}

  </style>
  <script type="x-shader/x-vertex" id="vertexshader">
      varying vec2 vUv;
      void main() {
        vUv = uv;
        gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);
      }
    </script>

  <script type="x-shader/x-fragment" id="fragmentshader">
      uniform sampler2D baseTexture;
      uniform sampler2D bloomTexture;
      varying vec2 vUv;
      void main() {
        gl_FragColor = (texture2D(baseTexture, vUv) + vec4(1.0) * texture2D(bloomTexture, vUv));
      }
    </script>

</head>

<body>
  <div id="ui-layer"
    style="position: fixed; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; z-index: 2000;">
    <!-- Drop indicator -->
    <div id="drop-indicator" class="drop-indicator" style="pointer-events: auto;"></div>

    <!-- Text Modal -->
    <div id="textModal-text3d" class="modal-text3d" style="pointer-events: auto;">
      <div class="modal-content-text3d">
        <span class="close-text3d">&times;</span>
        <h2 id="modalTitle-text3d"></h2>
        <p id="modalText-text3d"></p>
        <textarea id="editText-text3d" rows="10" cols="50"></textarea>
        <button id="sendButton-text3d">Send</button>
      </div>
    </div>

    <!-- Status Container -->
    <div id="status-container" style="pointer-events: auto;"></div>

    <!-- Sidebar -->
    <div class="sidebar" style="pointer-events: auto;">
      <div class="sidebar-icon" id="homeIcon">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
          stroke-linejoin="round">
          <path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"></path>
          <polyline points="9 22 9 12 15 12 15 22"></polyline>
        </svg>
        <span class="tooltip">Home</span>
      </div>
      <div class="sidebar-icon">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
          stroke-linejoin="round">
          <circle cx="11" cy="11" r="8"></circle>
          <line x1="21" y1="21" x2="16.65" y2="16.65"></line>
        </svg>
        <span class="tooltip">Search</span>
      </div>
      <div class="sidebar-icon" id="peer-btn-connect">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
          stroke-linejoin="round">
          <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path>
          <circle cx="12" cy="7" r="4"></circle>
        </svg>
        <span class="tooltip">Profile</span>
      </div>
      <div class="sidebar-icon">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
          stroke-linejoin="round">
          <circle cx="12" cy="12" r="3"></circle>
          <path
            d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z">
          </path>
        </svg>
        <span class="tooltip">Settings</span>
      </div>
      <div id='tests' class="sidebar-icon">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
          stroke-linejoin="round">
          <path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"></path>
          <polyline points="22,6 12,13 2,6"></polyline>
        </svg>
        <span class="tooltip">Messages</span>
      </div>

      <div id="fileTreeBtn" class="sidebar-icon">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
          stroke-linejoin="round">
          <path d="M3 3h18a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H3a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2z"></path>
          <path d="M3 7h18"></path>
          <path d="M3 11h18"></path>
          <path d="M3 15h18"></path>
        </svg>
        <span class="tooltip">File directory</span>
      </div>



      <div id="toggleButton" class="sidebar-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="24" height="24" fill="none"
          stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <path d="M17 3a2.828 2.828 0 1 1 4 4L7.5 20.5 2 22l1.5-5.5L17 3z" />
          <path d="M15 5l4 4" />
        </svg>
        <span class="tooltip">Chat with your docs</span>
      </div>

    </div>

    <!-- Separate left slideout -->
    <div class="left-slideout" id="leftSlideout">
      <div id="fileTreeContainer">
        <div class="tree" id="fileTree">
          <div class="mt-5 pl-3">
            <a href="http://blockchain.org">⿻ create story</a> |
            <a href="http://blockchain.org">⿻ create quest</a> |
            <a href="http://blockchain.org">⿻ create friend</a> <br> <br>
            <strong>File Viewer:</strong> File structure viewable in a TREE
          </div>
          <div class="tree">
            <ul>
              <li><i class="fa fa-folder-open"></i> Project
                <ul>
                  <li><i class="fa fa-folder-open"></i> Opened Folder <span>- 15kb</span>
                    <ul>
                      <li><i class="fa fa-folder-open"></i> css
                        <ul>
                          <li><i class="fa fa-code"></i> CSS Files <span>- 3kb</span>
                          </li>

                        </ul>
                      </li>
                      <li><i class="fa fa-folder"></i> Folder close <span>- 10kb</span>
                      </li>
                      <li><i class="fab fa-html5"></i> index.html</li>
                      <li><i class="fa fa-picture-o"></i> favicon.ico</li>
                    </ul>
                  </li>
                  <li><i class="fa fa-folder"></i> Folder close <span>- 420kb</span>

                  </li>
                </ul>
              </li>
            </ul>
          </div>


        </div>
      </div>
    </div>
    <div class="modal active" style=" pointer-events: all !important;">
      <input type="text" class="p2p_peer_input" id="userIdInput" placeholder="Enter your user ID"
        style="pointer-events: all !important;">
      <input type="text" class="p2p_peer_input" id="peerIdInput" placeholder="Enter peer ID to connect"
        style="pointer-events: all !important;">
      <button id="connectButton" style="pointer-events: all !important;">
        Connect
        <span class="tooltip">Click to connect to the peer</span>
      </button>
      <div id="status"></div>
    </div>

    <div id="popup"></div>
    <div id="overlay" class="overlay" style="display: none;"></div>

    <!-- <button id="toggleButton">Chat</button> -->
    <div class="slideout" id="chatSlideout">
      <div id="editor-container"></div>

    </div>
  </div>

  <div id="canvas-container" style="position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: 1;">
    <!-- Three.js canvas will render here -->
  </div>
  <script>
    const toggleButton = document.getElementById('toggleButton');
    const fileTreeBtn = document.getElementById('fileTreeBtn');
    const fileTree = document.getElementById('fileTree');
    const tests = document.getElementById('tests');
    const peerConnBtn = document.getElementById('peer-btn-connect');
    const modal = document.querySelector('.modal'); // Used by peer-btn-connect
    const leftSlideout = document.getElementById('leftSlideout');
    const chatSlideout = document.getElementById('chatSlideout');
    const homeIcon = document.getElementById('homeIcon');
    const icons = document.querySelectorAll('.sidebar-icon');
  
    // Create a separate modal for homeIcon
    const homeModal = document.createElement('div');
    homeModal.classList.add('modal');
    homeModal.style.display = 'none';
    document.body.appendChild(homeModal);
  
    let activeIcon = null;
  
    leftSlideout.classList.remove('active');
  
    fileTreeBtn.addEventListener('click', (e) => {
      e.stopPropagation();
  
      // Toggle the left slideout
      leftSlideout.classList.toggle('active');
  
      // Close other slideouts if open
      if (chatSlideout.classList.contains('active')) {
        chatSlideout.classList.remove('active');
      }
    });
  
    // Functions for peer-btn-connect modal
    function showPeerModal() {
      const iconRect = peerConnBtn.getBoundingClientRect();
      modal.style.top = `${iconRect.top - 15}px`;
      modal.style.display = 'flex';
  
      modal.offsetHeight; // Trigger reflow
  
      requestAnimationFrame(() => {
        modal.classList.add('active');
      });
  
      const arrowOffset = iconRect.height / 2;
      modal.style.setProperty('--arrow-top', `${arrowOffset + 10}px`);
      activeIcon = peerConnBtn;
    }
  
    function hidePeerModal() {
      modal.style.display = 'none';
      modal.classList.remove('active');
      activeIcon = null;
    }
  
    // Functions for homeIcon modal
    function showHomeModal() {
      const iconRect = homeIcon.getBoundingClientRect();
      homeModal.style.top = `${iconRect.top - 15}px`;
      homeModal.style.display = 'flex';
  
      homeModal.innerHTML = getHomeModalContent();
      attachHomeModalListeners();
  
      homeModal.offsetHeight; // Trigger reflow
  
      requestAnimationFrame(() => {
        homeModal.classList.add('active');
      });
  
      const arrowOffset = iconRect.height / 2;
      homeModal.style.setProperty('--arrow-top', `${arrowOffset + 10}px`);
      activeIcon = homeIcon;
    }
  
    function hideHomeModal() {
      homeModal.style.display = 'none';
      homeModal.classList.remove('active');
      activeIcon = null;
    }
  
    // Event Listeners for Icons
    peerConnBtn.addEventListener('click', (e) => {
      e.stopPropagation();
      e.preventDefault();
  
      if (modal.style.display === 'none') {
        showPeerModal();
      } else {
        hidePeerModal();
      }
  
      // Close slideouts if open
      leftSlideout.classList.remove('active');
      chatSlideout.classList.remove('active');
    });
  
    homeIcon.addEventListener('click', (e) => {
      e.stopPropagation();
      e.preventDefault();
  
      if (homeModal.style.display === 'none') {
        showHomeModal();
      } else {
        hideHomeModal();
      }
    });
  
    // Function to get homeModal content
    function getHomeModalContent() {
      return `
       <div class="modal-icons">
      <div class="modal-icon" data-action="visualize-embeddings">
        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="small-icon">
          <path stroke-linecap="round" stroke-linejoin="round" d="m21 7.5-9-5.25L3 7.5m18 0-9 5.25m9-5.25v9l-9 5.25M3 7.5l9 5.25M3 7.5v9l9 5.25m0-9v9" />
        </svg>
        <span class="tooltip">Visualized Embeddings in 3D Space</span>
      </div>
      <div class="modal-icon" data-action="cluster-nodes">
        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="small-icon">
          <path stroke-linecap="round" stroke-linejoin="round" d="m21 7.5-2.25-1.313M21 7.5v2.25m0-2.25-2.25 1.313M3 7.5l2.25-1.313M3 7.5l2.25 1.313M3 7.5v2.25m9 3 2.25-1.313M12 12.75l-2.25-1.313M12 12.75V15m0 6.75 2.25-1.313M12 21.75V19.5m0 2.25-2.25-1.313m0-16.875L12 2.25l2.25 1.313M21 14.25v2.25l-2.25 1.313m-13.5 0L3 16.5v-2.25" />
        </svg>
        <span class="tooltip">Cluster nodes</span>
      </div>
      <div class="modal-icon" data-action="show-network-graph">
        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="small-icon">
          <path stroke-linecap="round" stroke-linejoin="round" d="M9 6.75V15m6-6v8.25m.503 3.498 4.875-2.437c.381-.19.622-.58.622-1.006V4.82c0-.836-.88-1.38-1.628-1.006l-3.869 1.934c-.317.159-.69.159-1.006 0L9.503 3.252a1.125 1.125 0 0 0-1.006 0L3.622 5.689C3.24 5.88 3 6.27 3 6.695V19.18c0 .836.88 1.38 1.628 1.006l3.869-1.934c.317-.159.69-.159 1.006 0l4.994 2.497c.317.158.69.158 1.006 0Z" />
        </svg>
        <span class="tooltip">Show network graph</span>
      </div>
      <div class="modal-icon" data-action="filter-ideas">
        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="small-icon">
          <path stroke-linecap="round" stroke-linejoin="round" d="M12 3c2.755 0 5.455.232 8.083.678.533.09.917.556.917 1.096v1.044a2.25 2.25 0 0 1-.659 1.591l-5.432 5.432a2.25 2.25 0 0 0-.659 1.591v2.927a2.25 2.25 0 0 1-1.244 2.013L9.75 21v-6.568a2.25 2.25 0 0 0-.659-1.591L3.659 7.409A2.25 2.25 0 0 1 3 5.818V4.774c0-.54.384-1.006.917-1.096A48.32 48.32 0 0 1 12 3Z" />
        </svg>
        <span class="tooltip">Filter for specific ideas</span>
      </div>
    </div>
      `;
    }
  
    // Event Handlers for homeModal Icons
    function attachHomeModalListeners() {
      homeModal.querySelectorAll('.modal-icon').forEach(icon => {
        icon.addEventListener('click', (e) => {
          e.stopPropagation();
          const action = e.currentTarget.dataset.action;
          if (action) {
            showSpinner(e.currentTarget);
            console.log("Dispatching", action);
            const event = new CustomEvent('modalAction', { detail: { action } });
            document.dispatchEvent(event);
          }
        });
  
        const tooltip = icon.querySelector('.tooltip');
        if (tooltip) {
          icon.addEventListener('mouseenter', () => {
            tooltip.style.opacity = '1';
          });
          icon.addEventListener('mouseleave', () => {
            tooltip.style.opacity = '0';
          });
        }
      });
    }
  
    function showSpinner(iconElement) {
      const svgIcon = iconElement.querySelector('svg');
      const spinner = document.createElement('div');
      spinner.className = 'spinner';
      svgIcon.style.display = 'none';
      iconElement.insertBefore(spinner, svgIcon);
  
      setTimeout(() => {
        spinner.remove();
        svgIcon.style.display = '';
      }, 4000);
    }
  
    // Hide modals when clicking outside
    document.addEventListener('click', (e) => {
      if (!modal.contains(e.target) && !e.target.closest('.sidebar-icon')) {
        hidePeerModal();
      }
      if (!homeModal.contains(e.target) && !e.target.closest('.sidebar-icon')) {
        hideHomeModal();
      }
    });
  
    // Ensure modal events don't propagate
    modal.addEventListener('pointerdown', (e) => e.stopPropagation());
    modal.addEventListener('click', (e) => e.stopPropagation());
    homeModal.addEventListener('pointerdown', (e) => e.stopPropagation());
    homeModal.addEventListener('click', (e) => e.stopPropagation());
  
    // Tooltips for sidebar icons
    document.querySelectorAll('.sidebar-icon').forEach(icon => {
      icon.addEventListener('mouseenter', () => {
        icon.querySelector('.tooltip').style.opacity = '1';
      });
      icon.addEventListener('mouseleave', () => {
        icon.querySelector('.tooltip').style.opacity = '0';
      });
    });
  </script>
  
  <script type="module" src="/main.js"></script>
  
</body>

</html>